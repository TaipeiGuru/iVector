const ALT_MAP = {
    4000: 0x9EB271,
    5000: 0x4A993A,
    6000: 0x5AD317,
    7000: 0xD2EB59,
    8000: 0xF4D155

}

const TERRAIN_MAPS = {
    "hard": {
        name: "Coastal Region",
        zones: [
            {
                name: "Coastal Mountains",
                points: [
                    // Outer boundary (original shape)
                    {x: 740, y: 325}, {x: 870, y: 330}, {x: 940, y:315}, 
                    {x:990, y:320}, {x:1040, y:325}, {x:1140, y:350}, {x:1240, y:440}, 
                    {x:1270, y:480}, {x:1310, y:500}, {x:1360, y:510}, {x:1410, y: 500}, 
                    {x:1450, y:450}, {x:1465, y:390}, {x:1440, y:300}, {x:1340, y:250}, 
                    {x:1140, y:225},{x:940, y:220}, {x:840, y:190}, {x:740, y:150}, 
                    {x:640, y:120}, {x:540, y:140}, {x:490, y:180}, {x:480, y:230}, {x: 490, y: 270}, 
                    {x: 740, y: 325},
                    // Inner boundary (20 pixels inside)
                    {x: 760, y: 305}, {x: 510, y: 250}, {x: 500, y: 200}, {x: 540, y: 160}, 
                    {x: 640, y: 140}, {x: 740, y: 170}, {x: 840, y: 210}, {x: 940, y: 240}, 
                    {x: 1140, y: 245}, {x: 1340, y: 270}, {x: 1420, y: 310}, {x: 1440, y: 370}, 
                    {x: 1430, y: 430}, {x: 1390, y: 470}, {x: 1340, y: 490}, {x: 1290, y: 480}, 
                    {x: 1260, y: 440}, {x: 1240, y: 400}, {x: 1140, y: 330}, {x: 1040, y: 305}, 
                    {x:1010, y:302},{x: 1005, y: 290}, {x:1010, y:260}, {x:1040, y:242}, 
                    {x:940, y:240}, {x:910, y:230}, {x: 940, y: 295}, {x: 870, y: 310}, {x: 760, y: 305}
                ],
                minAltitude: 4000,
                color: ALT_MAP[4000], 
            },
            {
                name: "Coastal Hills",
                points: [
                    {x:910, y:232}, {x:840, y:210}, {x:740, y:170}, {x:640, y:140}, {x:540, y:160},
                    {x:500, y:200}, {x: 510, y: 250}, {x: 760, y: 305}, {x: 870, y: 310}, {x: 940, y: 295}
                ],
                minAltitude: 5000,
                color: ALT_MAP[5000], 
            },
            {
                name: "Coastal Hills",
                points: [
                    {x:1005, y:290}, {x:1010, y: 302}, {x:1040, y:305}, {x: 1140, y: 330}, {x:1240, y:400}, 
                    {x:1260, y:440}, {x:1290, y:480}, {x:1340, y:490}, {x:1390, y:470}, {x:1430, y:430}, 
                    {x:1440, y:370}, {x:1420, y:310}, {x:1340, y:270}, {x:1140, y:245}, {x:1040, y:243}, 
                    {x:1010, y:260}, {x:1240, y:280}, {x:1370, y:320}, {x:1400, y:360}, {x:1370, y:410}, 
                    {x:1340, y:430}, {x:1300, y:420}, {x:1260, y:390}, {x:1230, y:370}, {x:1190, y:330}, 
                    {x:1190, y:315}, {x:1210, y:290}, {x:1240, y:280}, {x:1010, y:260}
                ],
                minAltitude: 5000,
                color: ALT_MAP[5000], // Light green
            },
            {
                name: "Coastal Hills",
                points: [
                    {x:1210, y:290}, {x:1240, y:280}, {x:1370, y:320}, {x:1400, y:360}, {x:1370, y:410}, 
                    {x:1340, y:430}, {x:1300, y:420}, {x:1260, y:390}, {x:1230, y:370}, {x:1190, y:330}, 
                    {x:1190, y:315}, {x:1210, y:290}
                ],
                minAltitude: 6000,
                color: ALT_MAP[6000], 
            },
            {
                name: "Coastal Hills",
                points: [
                    {x:940, y:430}, {x:990, y:445}, {x:1040, y:450}, {x:1070, y:480}, {x:1080, y:520}, 
                    {x:1055, y:505}, {x:1050, y:480}, {x:1030, y:465}, {x:990, y:460}, {x:965, y:475}, 
                    {x:960, y:490}, {x:970, y:515}, {x:990, y:525}, {x:1020, y:530}, {x:1038, y:528}, 
                    {x:1055, y:505}, {x:1080, y:520}, {x: 1050, y:545}, {x:990, y:550}, {x:940, y:530}, 
                    {x:900, y:500}, {x:905, y:455}
                ],
                minAltitude: 4000,
                color: ALT_MAP[4000], 
            },
            {
                name: "Coastal Hills",
                points: [
                    {x:965, y:475}, {x:960, y:490}, {x:970, y:515}, {x:990, y:525}, {x:1020, y:530}, 
                    {x:1038, y:528}, {x:1055, y:505}, {x:1050, y:480}, {x:1030, y:465}, {x:990, y:460}, 
                    {x:990, y:480}, {x:1020, y:480}, {x:1035, y:490}, {x:1040, y:505}, {x:1030, y:515}, 
                    {x:1010, y:515}, {x:990, y:505}, {x:980, y:490}, {x:990, y:480}, {x:990, y:460} 
                ],
                minAltitude: 6000,
                color: ALT_MAP[6000], 
            },
            {
                name: "Coastal Hills",
                points: [
                    {x:990, y:480}, {x:1020, y:480}, {x:1035, y:490}, {x:1040, y:505}, 
                    {x:1030, y:515}, {x:1010, y:515}, {x:990, y:505}, {x:980, y:490}
                ],
                minAltitude: 7000,
                color: ALT_MAP[7000], 
            }
        ]
    },
    "medium": {
        name: "Coastal Region",
        zones: [
            {
                name: "test terrain",
                points: [
                    {x:590, y:855}, {x:570, y:830}, {x:575, y:790}, {x:600, y:750}, 
                    {x:650, y:690}, {x:700, y:680}, {x:775, y:680}, {x:900, y:700}, 
                    {x:950, y:690}, {x:1000, y:670}, {x:1050, y:675}, {x:1100, y:670}, 
                    {x:1150, y:660}, {x:1300, y:660}, {x:1320, y:670}, {x:1330, y:690}, 
                    {x:1365, y:730}, {x:1400, y:750}, {x:1440, y:765}, {x:1442, y:780}, 
                    {x:1450, y:792}, {x:1460, y:800}, {x:1455, y:820}, {x:1440, y:835}, 
                    {x:1400, y:850}, {x:1300, y:870}, {x:1250, y:870}, {x:1200, y:880}, 
                    {x:1150, y:890}, {x:1100, y:885}, {x:1075, y:872}, {x:1050, y:865},
                    {x:1000, y:870}, {x:950, y:880}, {x:900, y:900}, {x:900, y:870}, 
                    {x:1000, y:835}, {x:1100, y:840}, {x:1140, y:855}, {x:1175, y:860},
                    {x:1250, y:850}, {x:1400, y:820}, {x:1410, y:805}, {x:1410, y:790},
                    {x:1400, y:780}, {x:1390, y:775}, {x:1355, y:770}, {x:1320, y:745},
                    {x:1300, y:720}, {x:1275, y:690}, {x:1245, y:681}, {x:1217, y:688},
                    {x:1179, y:691}, {x:1143, y:697}, {x:1113, y:706}, {x:1077, y:707},
                    {x:1050, y:706}, {x:1010, y:705}, {x:978, y:716}, {x:940, y:723},
                    {x:909, y:728}, {x:867, y:723}, {x:823, y:713}, {x:788, y:708},
                    {x:753, y:705}, {x:711, y:707}, {x:670, y:720}, {x:640, y:741},
                    {x:624, y:763}, {x:608, y:787}, {x:600, y:810},{x:604, y:824}, 
                    {x:610, y:828}, {x:621, y:831}, {x:634, y:825}, {x:647, y:807}, 
                    {x:662, y:794}, {x:685, y:790}, {x:712, y:808}, {x:731, y:825}, 
                    {x:740, y:850}, {x:768, y:866}, {x:825, y:875}, {x:900, y:870}, 
                    {x:900, y:900}, {x:850, y:905}, 
                    {x:800, y:895}, {x:750, y:895}, {x:725, y:880}, {x:700, y:850}, 
                    {x:690, y:830}, {x:685, y:825}, {x:680, y:825}, {x:670, y:835}, 
                    {x:660, y:850}, {x:640, y:865}, {x:615, y:865}
                ],
                minAltitude: 5000,
                color: ALT_MAP[5000], // Dark olive green
            },
            {
                name: "test terrain",
                points: [
                    {x:600, y:810}, {x:608, y:787}, {x:624, y:763}, {x:640, y:741}, 
                    {x:670, y:720}, {x:711, y:707}, {x:753, y:705}, {x:788, y:708}, 
                    {x:823, y:713}, {x:867, y:723}, {x:909, y:728}, {x:940, y:723}, 
                    {x:978, y:716}, {x:1010, y:705}, {x:1050, y:706}, {x:1077, y:707}, 
                    {x:1113, y:706}, {x:1143, y:697}, {x:1179, y:691}, {x:1217, y:688}, 
                    {x:1245, y:681}, {x:1275, y:690}, {x:1300, y:720}, {x:1320, y:745}, 
                    {x:1355, y:770}, {x:1390, y:775}, {x:1400, y:780}, {x:1410, y:790}, 
                    {x:1410, y:805}, {x:1400, y:820}, {x:1250, y:850}, {x:1175, y:860}, 
                    {x:1140, y:855}, {x:1100, y:840}, {x:1000, y:835}, {x:900, y:870}, 
                    {x:894, y:844}, {x:894, y:844}, {x:938, y:831}, {x:971, y:819}, 
                    {x:994, y:809}, {x:1021, y:807}, {x:1063, y:807}, {x:1100, y:811}, 
                    {x:1135, y:820}, {x:1163, y:830}, {x:1195, y:839}, {x:1224, y:839}, 
                    {x:1256, y:836}, {x:1288, y:829}, {x:1311, y:825}, {x:1327, y:816}, 
                    {x:1338, y:807}, {x:1342, y:799}, {x:1336, y:784}, {x:1320, y:776}, 
                    {x:1316, y:772}, {x:1301, y:759}, {x:1286, y:741}, {x:1271, y:729}, 
                    {x:1251, y:718}, {x:1227, y:713}, {x:1211, y:717}, {x:1183, y:721}, 
                    {x:1155, y:725}, {x:1135, y:732}, {x:1103, y:737}, {x:1073, y:737}, 
                    {x:1041, y:737}, {x:1013, y:740}, {x:989, y:749}, {x:949, y:753}, 
                    {x:912, y:755}, {x:887, y:755}, {x:855, y:751}, {x:829, y:745}, 
                    {x:808, y:741}, {x:781, y:738}, {x:751, y:727}, {x:742, y:738}, 
                    {x:738, y:759}, {x:737, y:778}, {x:751, y:806}, {x:770, y:825}, 
                    {x:796, y:839}, {x:822, y:843}, {x:855, y:844}, {x:894, y:844}, 
                    {x:900, y:870}, 
                    {x:825, y:875}, {x:768, y:866}, {x:740, y:850}, {x:731, y:825}, 
                    {x:712, y:808}, {x:685, y:790}, {x:662, y:794}, {x:647, y:807}, 
                    {x:634, y:825}, {x:621, y:831}, {x:610, y:828}, {x:604, y:824}

                ],
                minAltitude: 6000,
                color: ALT_MAP[6000], 
            },
            {
                name: "test terrain",
                points: [
                    {x:781, y:738}, {x:777, y:763}, {x:770, y:777}, {x:771, y:786}, 
                    {x:779, y:799}, {x:792, y:810}, {x:808, y:816}, {x:829, y:822}, 
                    {x:851, y:824}, {x:882, y:821}, {x:914, y:816}, {x:944, y:810}, 
                    {x:964, y:800}, {x:975, y:791}, {x:977, y:781}, {x:965, y:774}, 
                    {x:919, y:777}, {x:886, y:776}, {x:852, y:777}, {x:827, y:773}, 
                    {x:797, y:769}, {x:777, y:763},
                    {x:781, y:738}, {x:808, y:741}, {x:829, y:745}, {x:855, y:751},
                    {x:887, y:755}, {x:912, y:755}, {x:949, y:753}, {x:989, y:749}, 
                    {x:1013, y:740}, {x:1041, y:737}, {x:1073, y:737}, {x:1103, y:737}, 
                    {x:1135, y:732}, {x:1155, y:725}, {x:1183, y:721}, {x:1211, y:717}, 
                    {x:1227, y:713}, {x:1251, y:718}, {x:1271, y:729}, {x:1286, y:741}, 
                    {x:1301, y:759}, {x:1316, y:772}, {x:1320, y:776}, {x:1336, y:784}, 
                    {x:1342, y:799}, {x:1338, y:807}, {x:1327, y:816}, {x:1311, y:825}, 
                    {x:1288, y:829}, {x:1256, y:836}, {x:1224, y:839}, {x:1195, y:839}, 
                    {x:1203, y:817},
                    {x:1180, y:810}, {x:1203, y:817}, {x:1226, y:817}, {x:1249, y:819}, {x:1270, y:815}, {x:1284, y:809}, {x:1290, y:795}, {x:1289, y:783}, {x:1286, y:775}, {x:1276, y:768}, {x:1259, y:760}, {x:1239, y:750}, {x:1217, y:748}, {x:1198, y:749}, {x:1159, y:756}, {x:1140, y:760},
                    {x:1133, y:769}, {x:1132, y:783}, {x:1137, y:794}, {x:1158, y:805}, {x:1180, y:810}, {x:1203, y:817}, {x:1195, y:839},
                    {x:1163, y:830}, {x:1135, y:820}, {x:1100, y:811}, {x:1063, y:807}, 
                    {x:1021, y:807}, {x:994, y:809}, {x:971, y:819}, {x:938, y:831}, 
                    {x:894, y:844}, {x:855, y:844}, {x:822, y:843}, {x:796, y:839}, 
                    {x:770, y:825}, {x:751, y:806}, {x:737, y:778}, {x:738, y:759}, 
                    {x:742, y:738}, {x:751, y:727}

                ],
                minAltitude: 7000,
                color: ALT_MAP[7000], 
            },
            {
                name: "test terrain",
                points: [
                    {x:1140, y:760}, {x:1159, y:756}, {x:1198, y:749}, {x:1217, y:748}, 
                    {x:1239, y:750}, {x:1259, y:760}, {x:1276, y:768}, {x:1286, y:775}, 
                    {x:1289, y:783}, {x:1290, y:795}, {x:1284, y:809}, {x:1270, y:815}, 
                    {x:1249, y:819}, {x:1226, y:817}, {x:1203, y:817}, {x:1180, y:810}, 
                    {x:1158, y:805}, {x:1137, y:794}, {x:1132, y:783}, {x:1133, y:769}
                ],
                minAltitude: 8000,
                color: ALT_MAP[8000], 
            },
            {
                name: "test terrain",
                points: [
                    {x:777, y:763}, {x:797, y:769}, {x:827, y:773}, {x:852, y:777}, 
                    {x:886, y:776}, {x:919, y:777}, {x:965, y:774}, {x:977, y:781}, 
                    {x:975, y:791}, {x:964, y:800}, {x:944, y:810}, {x:914, y:816}, 
                    {x:882, y:821}, {x:851, y:824}, {x:829, y:822}, {x:808, y:816}, 
                    {x:792, y:810}, {x:779, y:799}, {x:771, y:786}, {x:770, y:777}
                ],
                minAltitude: 8000,
                color: ALT_MAP[8000], 
            },
            {
                name: "test terrain",
                points: [
                    {x:717, y:319}, {x:691, y:320}, {x:665, y:315}, {x:638, y:307}, 
                    {x:625, y:312}, {x:599, y:328}, {x:586, y:347}, {x:566, y:359}, 
                    {x:528, y:356}, {x:514, y:333}, {x:510, y:317}, {x:508, y:299}, 
                    {x:508, y:281}, {x:512, y:265}, {x:522, y:251}, {x:529, y:241}, 
                    {x:553, y:223}, {x:567, y:209}, {x:581, y:205}, {x:601, y:204}, 
                    {x:610, y:222}, {x:611, y:239}, {x:611, y:251}, {x:627, y:258}, 
                    {x:660, y:266}, {x:693, y:271}, {x:705, y:278}, {x:717, y:295}, 
                    {x:722, y:305}
                ],
                minAltitude: 6000,
                color: ALT_MAP[6000], 
            },
            {
                name: "test terrain",
                points: [
                    {x:1186, y:58}, {x:1165, y:69}, {x:1144, y:65}, {x:1123, y:60}, 
                    {x:1105, y:62}, {x:1085, y:73}, {x:1078, y:90}, {x:1078, y:109}, 
                    {x:1087, y:124}, {x:1116, y:135}, {x:1131, y:138}, {x:1158, y:146}, 
                    {x:1177, y:158}, {x:1194, y:171}, {x:1216, y:182}, {x:1243, y:185}, 
                    {x:1264, y:191}, {x:1296, y:197}, {x:1345, y:201}, {x:1372, y:206}, 
                    {x:1408, y:198}, {x:1428, y:190}, {x:1453, y:175}, {x:1476, y:159}, 
                    {x:1489, y:136}, {x:1490, y:118}, {x:1487, y:95}, {x:1478, y:71}, 
                    {x:1464, y:62}, {x:1441, y:55}, {x:1427, y:56}, {x:1406, y:64}, 
                    {x:1389, y:70}, {x:1358, y:63}, {x:1324, y:54}, {x:1300, y:40}, {x:1250, y:39}
                ],
                minAltitude: 5000,
                color: ALT_MAP[5000], 
            }
        ]
    },
    "easy": {
        name: "Coastal Region",
        zones: [
            {
                name: "Coastal Mountains",
                points: [
                    {x:246, y:628}, {x:230, y:607}, {x:216, y:576}, {x:215, y:543}, 
                    {x:234, y:512}, {x:244, y:486}, {x:237, y:460}, {x:223, y:438}, 
                    {x:225, y:417}, {x:249, y:405}, {x:271, y:406}, {x:286, y:423}, 
                    {x:303, y:441}, {x:313, y:458}, {x:332, y:485}, {x:351, y:515}, 
                    {x:365, y:545}, {x:371, y:575}, {x:368, y:593}, {x:347, y:611}, 
                    {x:338, y:614}, {x:314, y:617}, {x:283, y:615}, {x:272, y:609}, 
                    {x:265, y:610}, {x:260, y:612}, {x:256, y:618}, {x:256, y:623}, 
                    {x:254, y:626}
                ],
                minAltitude: 4000,
                color: ALT_MAP[4000], 
            },
            {
                name: "Coastal Mountains",
                points: [
                    {x:819, y:25}, {x:797, y:34}, {x:787, y:54}, {x:791, y:75}, 
                    {x:808, y:91}, {x:823, y:95}, {x:837, y:95}, {x:866, y:93}, 
                    {x:882, y:83}, {x:895, y:70}, {x:899, y:51}, {x:897, y:30}, 
                    {x:883, y:12}, {x:864, y:11}, {x:840, y:11}
                ],
                minAltitude: 4000,
                color: ALT_MAP[4000], 
            },
            {
                name: "Coastal Mountains",
                points: [
                    {x:1037, y:889}, {x:1063, y:886}, {x:1087, y:873}, 
                    {x:1105, y:857}, {x:1122, y:836}, {x:1149, y:822}, {x:1174, y:822}, 
                    {x:1199, y:838}, {x:1214, y:864}, {x:1227, y:904}, {x:1234, y:926}, 
                    {x:1241, y:953}, {x:1262, y:963}, {x:1278, y:966}, {x:1300, y:967}, 
                    {x:1329, y:967}, {x:1358, y:967}, {x:1371, y:985}, {x:1371, y:1012}, 
                    {x:1355, y:1031}, {x:1330, y:1034}, {x:1299, y:1033}, {x:1262, y:1028}, 
                    {x:1241, y:1023}, {x:1210, y:1022}, {x:1193, y:1022}, {x:1177, y:1015}, 
                    {x:1159, y:1008}, {x:1150, y:995}, {x:1140, y:982}, {x:1118, y:983}, 
                    {x:1099, y:983}, {x:1073, y:977}, {x:1064, y:962}, {x:1064, y:940}, 
                    {x:1064, y:937}, {x:1054, y:923}, {x:1045, y:920}, {x:1036, y:916}, 
                    {x:1029, y:908}, {x:1024, y:900}, {x:1024, y:894}, {x:1027, y:890}
                ],
                minAltitude: 5000,
                color: ALT_MAP[5000], 
            }

        ]
    },
};

window.TERRAIN = {
    createTerrainVisualization: function(scene, map) {
        const terrainGraphics = scene.add.graphics();
        const currentMap = TERRAIN_MAPS[map || "medium"];
        // Clear previous terrain
        terrainGraphics.clear();
        
        currentMap.zones.forEach(zone => {
            // Base fill
            terrainGraphics.fillStyle(zone.color, 0.4);
            terrainGraphics.beginPath();
            terrainGraphics.moveTo(zone.points[0].x, zone.points[0].y);
            for (let i = 1; i < zone.points.length; i++) {
                terrainGraphics.lineTo(zone.points[i].x, zone.points[i].y);
            }
            terrainGraphics.closePath();
            terrainGraphics.fillPath();
            
            // Border for better visibility
            terrainGraphics.lineStyle(2, zone.color, 0.8);
            terrainGraphics.strokePath();
        });
        
        return terrainGraphics;
    },
    isPointInPolygon: function(point, polygon) {
        let inside = false;
        for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
            const xi = polygon[i].x, yi = polygon[i].y;
            const xj = polygon[j].x, yj = polygon[j].y;
            
            if (((yi > point.y) !== (yj > point.y)) &&
                (point.x < (xj - xi) * (point.y - yi) / (yj - yi) + xi)) {
                inside = !inside;
            }
        }
        return inside;
    },
    getTerrainAltitudeAtPoint: function(x, y, map) {
        if (map === "none") return 0;
        const currentMap = TERRAIN_MAPS[map];
        let maxAltitude = 0; // Start with sea level
        for (const zone of currentMap.zones) {
            if (TERRAIN.isPointInPolygon({x, y}, zone.points)) {
                maxAltitude = Math.max(maxAltitude, zone.minAltitude);
            }
        }
        return maxAltitude;
    }
    
};